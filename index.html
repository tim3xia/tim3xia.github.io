<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Would You Rather - Multiplayer</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: 20px auto; }
    .question { margin: 20px 0; }
    button { margin: 10px 5px; padding: 8px 15px; }
    #result { background: #f5f5f5; padding: 15px; border-radius: 8px; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>Would You Rather - Multiplayer</h2>

  <div id="form">
    <label>ä½ çš„æš±ç¨±ï¼š</label><br>
    <input id="nickname" placeholder="è¼¸å…¥æš±ç¨±"><br><br>

    <div id="questions"></div>
    <button onclick="submitAnswers()">æäº¤ç­”æ¡ˆ</button>
  </div>

  <div id="result" style="display:none;"></div>

  <script type="module">
    // --- Firebase Config (è«‹æ›æˆä½ çš„å°ˆæ¡ˆè³‡è¨Š) ---
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
	const firebaseConfig = {
		apiKey: "AIzaSyAPRJsQCBPbbrbcOFTJDkl3LMwkKf9Lc8E",
		authDomain: "match-wouldyourather.firebaseapp.com",
		databaseURL: "https://match-wouldyourather-default-rtdb.asia-southeast1.firebasedatabase.app",
		projectId: "match-wouldyourather",
		storageBucket: "match-wouldyourather.firebasestorage.app",
		messagingSenderId: "275894995617",
		appId: "1:275894995617:web:7e1845c39badb32a41fee0",
		measurementId: "G-1H6F34WYGJ"
	};

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- é¡Œç›® ---
    const questions = [
      "Would you rather have the ability to fly ğŸª½ or be invisible ğŸ‘»?",
      "Would you rather live in the city ğŸŒ† or the countryside ğŸŒ³?",
      "Would you rather always be 10 minutes late â° or always 20 minutes early âŒ›?",
      "Would you rather give up social media ğŸ“± or give up TV ğŸ“º?",
      "Would you rather be rich ğŸ’° and unknown ğŸ¤ or poor ğŸ’¸ and famous ğŸŒŸ?",
      "Would you rather never use the internet again ğŸŒ or never take an airplane âœˆï¸?",
      "Would you rather read minds ğŸ§  or predict the future ğŸ”®?",
      "Would you rather be always hot ğŸ”¥ or always cold â„ï¸?",
      "Would you rather explore space ğŸš€ or the deep sea ğŸŒŠ?",
      "Would you rather always have free food ğŸ” or always have free travel âœˆï¸?"
    ];

    let myNickname = null;
    let myAnswers = null;

    // é¡¯ç¤ºé¡Œç›®
    const qDiv = document.getElementById("questions");
    questions.forEach((q, i) => {
      const div = document.createElement("div");
      div.className = "question";
      div.innerHTML = `
        <p>${i+1}. ${q}</p>
        <label><input type="radio" name="q${i}" value="A"> Option A</label>
        <label><input type="radio" name="q${i}" value="B"> Option B</label>
      `;
      qDiv.appendChild(div);
    });

    async function submitAnswers() {
      myNickname = document.getElementById("nickname").value.trim();
      if (!myNickname) { alert("è«‹è¼¸å…¥æš±ç¨±"); return; }

      const selected = [];
      for (let i=0; i<questions.length; i++) {
        const choice = document.querySelector(`input[name="q${i}"]:checked`);
        if (!choice) { alert(`è«‹å›ç­”ç¬¬ ${i+1} é¡Œ`); return; }
        selected.push(choice.value);
      }
      myAnswers = selected;

      // å¯«å…¥ DBï¼ˆæ¯å€‹æš±ç¨±å”¯ä¸€ï¼‰
      await set(ref(db, "participants/" + myNickname), { nickname: myNickname, answers: selected });
      document.getElementById("form").style.display = "none";
      document.getElementById("result").style.display = "block";
      document.getElementById("result").innerHTML = "<p>ç­‰å¾…å…¶ä»–äººå®Œæˆä½œç­”ä¸­...</p>";
    }

    // --- ç›£è½è³‡æ–™åº«å³æ™‚æ›´æ–° ---
    onValue(ref(db, "participants"), (snapshot) => {
      if (!myNickname || !myAnswers) return; // å°šæœªå›ç­”
      if (!snapshot.exists()) return;

      const allData = snapshot.val();
      const entries = Object.values(allData);
      const me = entries.find(p => p.nickname === myNickname);
      if (!me) return;

      let mostSimilar = null, leastSimilar = null;
      let maxScore = -1, minScore = 999;

      entries.forEach(p => {
        if (p.nickname !== me.nickname) {
          let same = 0;
          for (let i=0; i<questions.length; i++) {
            if (p.answers[i] === me.answers[i]) same++;
          }
          let score = same / questions.length;
          if (score > maxScore) { maxScore = score; mostSimilar = p.nickname; }
          if (score < minScore) { minScore = score; leastSimilar = p.nickname; }
        }
      });

      let msg = `<h3>çµæœ for ${me.nickname}</h3>`;
      if (entries.length === 1) {
        msg += `<p>ç›®å‰åªæœ‰ä½ ä¸€å€‹äººä½œç­”ï¼Œç­‰å…¶ä»–äººåŠ å…¥å†ä¾†çœ‹çœ‹é…å°å§ï¼</p>`;
      } else {
        msg += `<p>ğŸ¯ ä½ å’Œ <b>${mostSimilar}</b> æœ€ç›¸ä¼¼ (${Math.round(maxScore*100)}%)</p>`;
        msg += `<p>âš¡ ä½ å’Œ <b>${leastSimilar}</b> æœ€ä¸ç›¸ä¼¼ (${Math.round(minScore*100)}%)</p>`;
      }

      document.getElementById("result").innerHTML = msg;
    });
  </script>
</body>
</html>
